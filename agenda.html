
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Agenda de Servi√ßos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBOc-qReOgBoDWQOYVNSlNMgRjF_hfH6uw",
      authDomain: "sistema-chamados-99e49.firebaseapp.com",
      projectId: "sistema-chamados-99e49",
      storageBucket: "sistema-chamados-99e49.appspot.com",
      messagingSenderId: "680351942005",
      appId: "1:680351942005:web:896b35a40f094d42297f3c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl font-bold mb-4">üìÖ Agenda de Servi√ßos</h1>
  <div id="calendar" class="bg-white rounded shadow p-4"></div>

  <!-- Modal Detalhado -->
  <div id="modalDetalhes" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full">
      <h2 class="text-xl font-bold mb-4">Detalhes do Agendamento</h2>
      <div id="detalhesConteudo" class="space-y-2 text-gray-800"></div>
      <button onclick="fecharModal()" class="mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Fechar</button>
    </div>
  </div>

  <script>
    function fecharModal() {
      document.getElementById("modalDetalhes").classList.add("hidden");
    }

    document.addEventListener("DOMContentLoaded", function () {
      auth.onAuthStateChanged(user => {
        if (!user) {
          alert("Voc√™ precisa estar logado.");
          window.location.href = "login-tecnico.html";
          return;
        }

        const calendarEl = document.getElementById("calendar");
        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: "dayGridMonth",
          locale: "pt-br",
          events: async function(fetchInfo, successCallback, failureCallback) {
            try {
              const snap = await db.collection("agendamentos").get();
              const eventos = snap.docs.map(doc => {
                const data = doc.data();
                return {
                  id: doc.id,
                  title: `${data.cliente} - ${data.servico}`,
                  start: data.data,
                  extendedProps: data
                };
              });
              successCallback(eventos);
            } catch (err) {
              console.error("Erro ao carregar eventos:", err);
              failureCallback(err);
            }
          },
          eventClick: function(info) {
            const dados = info.event.extendedProps;
            const html = `
              <p><strong>Cliente:</strong> ${dados.cliente}</p>
              <p><strong>T√©cnico:</strong> ${dados.tecnico}</p>
              <p><strong>Data:</strong> ${dados.data}</p>
              <p><strong>Servi√ßo:</strong> ${dados.servico}</p>
              <p><strong>Problema:</strong> ${dados.problema}</p>
              <p><strong>Status:</strong> ${dados.status || "Aberto"}</p>
              <p><strong>Observa√ß√µes:</strong> ${dados.observacoes || "-"}</p>
            `;
            document.getElementById("detalhesConteudo").innerHTML = html;
            document.getElementById("modalDetalhes").classList.remove("hidden");
          }
        });

        calendar.render();
      });
    });
  </script>
</body>
</html>
